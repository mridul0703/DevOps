---
- name: Configure web server on Azure VM
  hosts: all
  become: yes
  tasks:
      - name: Ensure Python is installed
        raw: |
            if ! command -v python3 >/dev/null 2>&1; then
              apt-get update && apt-get install -y python3
            fi
      - name: Update apt cache
        apt:
            update_cache: yes
            cache_valid_time: 3600

      - name: Install nginx
        apt:
            name: nginx
            state: present

      - name: Ensure nginx is running and enabled
        service:
            name: nginx
            state: started
            enabled: yes

      - name: Create /var/www/html/index.html
        copy:
            dest: /var/www/html/index.html
            content: "<h1>Hello from Terraform + Ansible on Azure</h1>"
            owner: www-data
            group: www-data
            mode: "0644"
